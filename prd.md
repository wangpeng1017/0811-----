### **产品需求文档 (PRD)：图片地理位置展示工具 (V1.0)**

| **文档版本** | **日期** | **作者** | **变更说明** |
| :--- | :--- | :--- | :--- |
| V1.0 | 2025年8月11日 | [您的名字] | 初始版本，整合功能、安全及成本控制需求 |

---

### **1. 项目概述**

#### **1.1 项目背景与目标**

随着移动互联网的普及，用户随时随地分享图片已成为常态。很多时候，用户希望快速知道一张图片拍摄的具体地理位置。本项目旨在开发一个轻量级的手机网页应用，让用户能通过微信内嵌的浏览器直接访问、上传图片，并快速获取该图片详尽的地理位置信息。

项目的核心目标是：**极简、快速、精准、安全、可控**。我们追求最简单的操作流程和最快的上线速度，通过集成强大的AI能力，在保证数据安全和成本可控的前提下，为用户提供精确到经纬度的地理位置数据。

#### **1.2 目标用户**

*   **普通微信用户**：希望快速了解自己或他人照片拍摄地点的用户。
*   **旅行爱好者**：整理旅行照片，需要快速标记地理位置的用户。
*   **内容创作者**：需要在图文中精确标注地理信息的博主或编辑。

#### **1.3 核心功能**

用户上传一张图片，系统将自动分析并展示图片拍摄的地理位置，信息维度包括：大洲、国家、省份/州、城市、具体地名、纬度和经度。

---

### **2. 产品需求**

#### **2.1 功能需求：图片上传与位置解析**

*   **用户故事**:
    *   作为一名用户，我希望能在一个简洁的网页上点击一个按钮，然后从我的手机相册里选择一张照片上传。
    *   作为一名用户，我希望上传图片后，页面能立刻告诉我这张照片是在哪个大洲、哪个国家、哪个城市，甚至是具体某个地点拍摄的。
    *   作为一名用户，我希望除了文字地址，还能看到精确的经纬度，方便我在地图应用中查看。

*   **详细需求**:
    1.  **访问方式**：用户通过微信扫描二维码或点击链接，可在微信内置浏览器中直接打开网页。
    2.  **上传入口**：界面核心位置提供一个清晰的“上传图片”按钮。
    3.  **图片选择**：点击按钮后，调用手机系统的图片选择器，允许用户从相册选择或现场拍摄。
    4.  **上传处理**：
        *   支持常见的图片格式（如 JPEG, PNG, HEIC）。
        *   上传过程中应有明确的加载提示（例如，一个旋转的图标或进度条）。
        *   建议在前端对图片进行适当压缩，以优化上传速度和节省服务器资源，同时需确保不丢失关键的EXIF元数据。
    5.  **AI解析**：
        *   前端将用户上传的图片数据发送至我方后端（Serverless Function）。
        *   后端调用智谱AI的API (`https://zhipuaishengchan.datasink.sensorsdata.cn/t/bv`) 对图片进行地理位置解析。
        *   后端需处理AI接口可能返回的各种情况（成功、失败、无法识别、用量超限等）。
    6.  **结果展示**：
        *   在当前页面清晰地展示解析出的地理位置信息。
        *   展示格式：
            *   大洲：[例如，亚洲]
            *   国家：[例如，中国]
            *   省份/州：[例如，北京市]
            *   城市：[例如，北京市]
            *   地名：[例如，天安门广场]
            *   纬度：[例如，39.908721]
            *   经度：[例如，116.397472]
        *   如果AI无法识别或图片不含位置信息，应向用户展示友好的提示信息，如“无法识别图片位置，请尝试其他照片”。
        *   如果因用量超限导致服务不可用，应提示“服务繁忙，请稍后再试”。
    7.  **再次上传**：结果展示页面下方提供“重新上传”按钮，方便用户进行下一次查询。

#### **2.2 系统流程图**

**用户与系统交互流程：**
```mermaid
graph TD
    subgraph 用户端 (手机浏览器)
        A[用户打开网页] --> B[点击上传图片];
        B --> C[选择图片];
        C --> D[显示上传中...];
        D --> E[将图片安全发送至我方后端];
        E --> I[接收并展示地理位置结果];
        I --> J[点击“重新上传”];
        J --> B;
        E --> L[接收并提示错误信息];
        L --> J;
    end

    subgraph 我方后端 (Vercel/Netlify Serverless Function)
        E --> F[接收图片];
        F --> F_SEC{安全读取环境变量中的API Token};
        F_SEC --> F_LIMIT{检查总Token用量是否超限};
        F_LIMIT -- 未超限 --> G[调用智谱AI接口];
        F_LIMIT -- 已超限 --> K_LIMIT[返回“服务暂不可用”错误];
        G --> H[接收AI返回数据];
        H --> H_PARSE[解析并格式化地理位置];
        H_PARSE --> I;
        G -- AI返回错误 --> K[返回“无法识别”错误];
        K --> L;
        K_LIMIT --> L;
    end

    subgraph 第三方服务
        G --> AI_SERVICE[智谱AI API];
        F_LIMIT --> DB[(数据库/KV存储)];
        H --> DB_UPDATE[更新Token用量];
    end
```

#### **2.3 非功能性需求**

*   **界面设计 (UI/UX)**:
    *   **极简主义**：界面只包含核心元素：一个标题、一个上传按钮、一个结果展示区和一个页脚版权信息。无多余装饰、无复杂导航。
    *   **响应式设计**：优先为手机端竖屏展示优化，确保在主流手机屏幕尺寸上显示良好。
    *   **交互友好**：操作反馈及时明确，如点击按钮有视觉变化，上传中有加载状态。

*   **性能**:
    *   **快速加载**：首次打开页面的加载时间应尽可能短。可通过优化图片资源、使用CDN等方式实现。
    *   **快速响应**：图片上传和AI解析的总时长应力争在5秒内完成（具体取决于网络和AI服务速度），并全程给予用户清晰的状态反馈。

*   **部署与访问**:
    *   **部署平台**：选用 Netlify 或 Vercel 进行部署。这两个平台提供免费套餐、自动化部署（CI/CD）和全球CDN，非常适合快速上线和迭代。
    *   **中国大陆访问**：上线后需进行实际测试，如果访问性问题严重，可考虑后续增加国内的CDN或备案服务器。

*   **开发与技术**:
    *   **开发工具**：使用 Cursor 进行开发，以利用其AI辅助编码能力，提升开发效率。
    *   **技术栈（建议）**:
        *   前端：Vue.js (Nuxt.js) 或 React (Next.js)。
        *   后端：使用Vercel/Netlify的Serverless Functions来处理与智谱AI的API交互，实现“零服务器”运维。

*   **安全性 (Security)**
    *   **API Token保密**：**严禁**将智谱AI的API Token直接写在前端代码中。
    *   **实现方式**：
        1.  API Token必须作为**环境变量**存储在Vercel或Netlify的平台设置中。
        2.  前端页面不直接请求智谱AI，而是请求我们自己部署的后端接口（Serverless Function）。
        3.  后端接口从环境变量中安全地读取API Token，并用其调用智谱AI。这样，Token始终保留在服务器端，不会暴露给最终用户。

*   **成本与用量控制 (Cost & Usage Control)**
    *   **需求**：系统调用的智谱AI总Token数量不能超过2000万，以控制成本。
    *   **实现方案 (按优先级选择)**：
        *   **方案一 (首选)**：**利用AI提供商的后台设置**。登录智谱AI开发者后台，寻找并设置“预算”、“用量硬性限制”或“消费上限”等功能。这是最简单、最可靠的方式。
        *   **方案二 (备选)**：**自建用量统计与限制系统**。仅当方案一不可用时考虑。
            1.  **数据存储**：使用Vercel KV 或 Vercel Postgres等与Serverless Function集成的数据库。
            2.  **处理流程**：在调用AI前，后端函数先从数据库读取当前累计用量。若`（当前用量 + 本次预估量）> 2000万`，则拒绝调用并返回错误。调用成功后，将实际消耗的Token数更新回数据库。此方案增加了开发复杂性。

---

### **3. 里程碑与排期 (示例)**

*   **第一周 (W1)**:
    *   完成最终技术选型，搭建开发环境。
    *   **重点**：在Vercel/Netlify上配置好环境变量，并搭建好调用智谱AI的Serverless Function基础框架，完成安全调用流程的验证。
    *   完成极简UI界面开发。
*   **第二周 (W2)**:
    *   开发前端图片上传功能。
    *   **重点**：实现“成本与用量控制”方案。优先调研智谱后台，若不可行，则搭建Vercel KV并开发用量统计逻辑。
    *   完成前后端数据联调。
*   **第三周 (W3)**:
    *   进行内部测试，修复BUG。
    *   优化UI/UX细节和性能。
    *   准备正式上线（例如，生成二维码，准备分享链接等）。
    *   **目标：第三周末或第四周初正式上线**。

---
**文档结束**